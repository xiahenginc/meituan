  <html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
  <title></title>
  <link href="lib/ionic/css/ionic.css" rel="stylesheet">
   <body>
			  <div id="fromswift">这里的文字是swift直接调用的,点击右上角测试按钮</div>
				<br/>
	           <button id="callmapview" class="button  button-full button-large button-positive">调用本地地图</button>
			   </br>
               <button id="getcurrentlocation" class="button  button-full button-large button-positive">获取当前地图坐标</button>
			   获取当前坐标为：<div id="cotxt"></div>
			   </br>
			   <button id="pushpage1" class="button  button-full button-large button-royal">在当前窗口改变页面(www.baidu.com)</button>
			   </br>
 			   <button id="pushpage2" class="button  button-full button-large button-royal">弹出新页面到新窗口(www.baidu.com)</button>
				</br>
			   <button id="refreshallsessions" class="button  button-full button-large button-dark">重新载入当前页(刷新session)</button>
			   刷新结果为：<div id="refreshtxt"></div>
				</br>
			   <button id="qrbtn"  class="button  button-full button-large button-assertive">扫描二维码</button>
			   扫描到的二维码为：<div id="qrtxt"></div>
			   </br>
 			   <button onclick="setimage()" class="button  button-full button-large button-positive">选择图片</button>
			   <img id="image" width="100%" height="100%" />
			   
			   <script type="text/javascript">
            function createjsonreq(types,p1,p2){
                var jsonobj = {type:types,param1:p1,param2:p2};
                return jsonobj;
            }
            function setimage(){
                var x = document.getElementById("image")
                x.src = "http://localdevice/pic"
            }

            function connectWebViewJavascriptBridge(callback) {
                if (window.WebViewJavascriptBridge) {
                    callback(WebViewJavascriptBridge)
                } else {
                    document.addEventListener('WebViewJavascriptBridgeReady', function() {
                        callback(WebViewJavascriptBridge)
                    }, false)
                }
            }

            connectWebViewJavascriptBridge(function(bridge) {
                /*初始化代码,不管他,但一定要写*/
                bridge.init(function(message, responseCallback) {
                })
                /*点击扫描二维码*/
                var button = document.getElementById('qrbtn')
                   button.onclick = function(e) {
                       e.preventDefault();
                    //createjsonreq('req','qr','','')
                       bridge.callHandler('qr',createjsonreq('req','',''),function responseCallback(jsonobj) {
                            var divtxt = document.getElementById('qrtxt')
                            divtxt.innerText = jsonobj.param2
                        })
                }
                /*js判断登录成功后刷新*/
               var btnRefreshSessions = document.getElementById('refreshallsessions')
               btnRefreshSessions.onclick = function(e) {
               e.preventDefault();
               bridge.callHandler('ras',createjsonreq('req','',''), function responseCallback(jsonobj) {
                           var divtxt = document.getElementById('refreshtxt')
                           divtxt.innerText = jsonobj.param2
                    })
               }
                /*改变当前窗口地址*/
                var btnpp1 = document.getElementById('pushpage1')
                btnpp1.onclick = function(e) {
                    e.preventDefault();
                    bridge.callHandler('pp',createjsonreq('req','http://www.baidu.com','self'), function responseCallback(jsonobj){
                         // var divtxt = document.getElementById('fromswift')
                         // divtxt.innerText = jsonobj.param2
                    })
                }
                /*弹出新页面*/
                var btnpp2 = document.getElementById('pushpage2')
                btnpp2.onclick = function(e) {
                e.preventDefault();
                bridge.callHandler('pp',createjsonreq('req','http://www.baidu.com','blank'), function responseCallback(jsonobj) {
                     // var divtxt = document.getElementById('fromswift')
                    //  divtxt.innerText = jsonobj.param2
                      })
                }
                /*获取当前位置*/
               var btngcl = document.getElementById('getcurrentlocation')
               btngcl.onclick = function(e) {
               e.preventDefault();
               bridge.callHandler('gcl',createjsonreq('req','',''), function responseCallback(jsonobj) {
                      var divtxt = document.getElementById('cotxt')
                      divtxt.innerText = jsonobj.param2
                      })
               }
               /*调用地图*/
               var btncmv = document.getElementById('callmapview')
               btncmv.onclick = function(e) {
               e.preventDefault();
               bridge.callHandler('cmv',createjsonreq('req','',''), function responseCallback(jsonobj) {
                                //  var divtxt = document.getElementById('fromswift')
                               //   divtxt.innerText = jsonobj.param2
                                  })
               }
                /*来自swift直接调用*/
               bridge.registerHandler('calljs', function(jsonobj, responseCallback) {
                  var divtxt = document.getElementById('fromswift')
                  divtxt.innerText = jsonobj.param2
                  responseCallback(createjsonreq('res',jsonobj.cmdstr,'t1','t2'))
                })
            })
                
        </script>
 </body>
  </html>
